<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG em C: L√≥gica e Arquitetura de C√≥digo</title>
    <link rel="stylesheet" href="style_03.css">
</head>
<body>
    <video id="meuvideo" src="../midias/wallpaper.mp4" autoplay muted loop></video>

    <header id="cabecalho">
        <div id="cabecalho_flex">
            <a href="https://portal.uern.br/" target="_blank"><img src="../midias/LOGOMARCA_UERN_Branca.png" class="uern" alt="Logo UERN"></a>
            <div id="texoCabe">
                <h1 id="saudacao">Arquitetura de C√≥digo</h1>
                <a href="../segunda.html">
                    <h1 id="descr">L√≥gica de Inicializa√ß√£o, F√≥rmulas de Combate e Gerenciamento de Buffer/Mem√≥ria em C.</h1>
                </a>
            </div>
            <a href="https://github.com/NielS2Dev" target="_blank" class="nielpequeno"><img src="../midias/niel_pequeno2.png" alt="Desenvolvedor"></a>
        </div>
    </header>

    <main>
        <div class="container">
            <h1>üß† A L√≥gica Central e o Fluxo do Jogo</h1>
            <h2>Gerenciamento de Mem√≥ria, Input e Modularidade</h2>
            <p>
                A arquitetura do nosso RPG √© baseada na sincronia de v√°rios m√≥dulos. O estado do her√≥i √© passado por **refer√™ncia** (<code>*heroi</code>) e monitorado por m√∫ltiplos loops e verifica√ß√µes condicionais, garantindo que a l√≥gica de *gameplay* e a rastreabilidade de dados funcionem em perfeita sintonia.
            </p>

            <section class="configuracao-rpg">
                <h3>1. L√≥gica de Inicializa√ß√£o e Gerenciamento de Mem√≥ria</h3>
                <h4>A. Navega√ß√£o de Classe: A L√≥gica de Input (<code>loopClasses()</code>)</h4>
                <p>A sele√ß√£o de classe √© o primeiro grande desafio de l√≥gica, resolvido com aritm√©tica modular:</p>
                
                <ul>
                    <li>
                        <p><strong>Controle de Estado:</strong> A fun√ß√£o usa a vari√°vel <code>estado_atual</code> para rastrear a classe exibida (0 a 3).</p>
                    </li>
                    <li>
                        <p><strong>F√≥rmula Modular C√≠clica:</strong> Para avan√ßar e retroceder nas setas, a l√≥gica usa a matem√°tica de m√≥dulo (<code>%</code>) para garantir que o array seja percorrido de forma c√≠clica (ex: da classe 3 para a 0, e vice-versa).</p>
                        <div id="imagem_001">
                            <a href="" class="fotogeral"><img src="../midias/logicamodular.png" alt="" title="C√°lculo modular para navega√ß√£o de setas"></a>
                        </div>
                        <p><strong>Avan√ßar:</strong> <code>estado_atual = (estado_atual + 1) % total_classes;</code></p>
                        <p><strong>Retroceder:</strong> <code>estado_atual = ((estado_atual - 1 + total_classes) % total_classes);</code></p>
                    </li>
                    <li>
                        <p><strong>Integra√ß√£o Visual:</strong> A cada mudan√ßa de estado, a fun√ß√£o chama o m√≥dulo de Desenhos (<code>guerreiro()</code>, <code>mago()</code>, etc.), alinhando visual e estado.</p>
                    </li>
                </ul>

                <h4>B. Popula√ß√£o e Persist√™ncia de Dados (O Primeiro Registro)</h4>
                <ul>
                    <li>
                        <p><strong>Atribui√ß√£o de Atributos:</strong> O ID da classe √© passado para <code>atribuirEInicializarHeroi()</code> (do <code>log.c</code>) para popular os campos da <code>struct usuario</code>. Exemplo: Guerreiro (1500 de vida); Mago (600 de vida).</p>
                    </li>
                    <li>
                        <p><strong>Atribui√ß√£o de Habilidades:</strong> Em seguida, <code>atribuirClasse()</code> (do <code>combate.c</code>) copia os dados do <code>bancoDeSkills</code> para o array <code>skills[3]</code> do her√≥i.</p>
                    </li>
                    <li>
                        <p><strong>Registro Inicial (<code>log.c</code>):</strong> A chamada a <code>salvarDadosUsuario()</code> abre o <code>HistoricoJogadores.txt</code> em modo **ap√™ndice** (<code>"a"</code>) e registra o nick e os atributos base do her√≥i.</p>
                    </li>
                </ul>

                <h3>2. O Combate e a L√≥gica Matem√°tica da Sobreviv√™ncia</h3>
                <p>O cora√ß√£o do jogo √© a fun√ß√£o <code>lutar()</code>, que opera em um loop de turno com l√≥gica matem√°tica rigorosa.</p>

                <h4>A. O Ciclo de Turno e o Gerenciamento de E/S</h4>
                <ul>
                    <li>
                        <p><strong>Integra√ß√£o Visual/Cor:</strong> Todas as fun√ß√µes de exibi√ß√£o usam <code>mudarCor()</code> (da <code>windows.h</code>) para diferenciar elementos. Exemplo: Vida do her√≥i √© **verde** (<code>mudarCor(10)</code>); Vida do monstro √© **vermelha** (<code>mudarCor(12)</code>).</p>
                    </li>
                    <li>
                        <p><strong>Limpeza de Buffer:</strong> Ap√≥s qualquer <code>scanf</code>, a l√≥gica chama <code>limparBuffer()</code> (do <code>animacao.c</code>). Isso √© vital para a robustez, pois previne que o caractere <code>\n</code> interfira na pr√≥xima leitura de input.</p>
                        <div id="imagem_002">
                            <a href="" class="fotogeral"><img src="../midias/limparbuffer.png" alt="" title="Implementa√ß√£o da fun√ß√£o limparBuffer()"></a>
                        </div>
                    </li>
                </ul>

                <h4>B. A L√≥gica Matem√°tica da Vida e do Dano</h4>
                <p>O c√°lculo de dano √© uma subtra√ß√£o direta, mas estritamente controlada:</p>
                <div id="imagem_003_004">
                    <a href="" class="fotogeral"><img src="../midias/formuladedano.png" alt="" title="F√≥rmula de c√°lculo de dano no c√≥digo"></a>
                </div>
                <ul>
                    <li>
                        <p><strong>Mitiga√ß√£o de Dano:</strong> O dano efetivo √© calculado por:</p>
                        $$\text{Dano Causado} = (\text{Dano Bruto}) - (\text{Monstro.Defesa})$$
                    </li>
                    <li>
                        <p><strong>Regra de Dano M√≠nimo:</strong> A l√≥gica inclui um piso de dano: <code>if (danoCausado < 1) danoCausado = 1;</code>. Isso garante que o her√≥i nunca erre e sempre cause **um ponto de dano**, independentemente da defesa do monstro.</p>
                    </li>
                    <li>
                        <p><strong>Contra-Ataque:</strong> O dano recebido usa a mesma l√≥gica: <code>Dano Recebido = Monstro.Ataque - Her√≥i.Defesa</code>.</p>
                    </li>
                </ul>

                <h3>3. A L√≥gica de Recursos e Rastreabilidade da Po√ß√£o</h3>
                <p>O m√≥dulo <code>pocao.c</code> implementa uma l√≥gica de desvio estrat√©gico do combate:</p>
                <ul>
                    <li>
                        <p><strong>Controle de Uso:</strong> A fun√ß√£o <code>menuPorcoes()</code> verifica se <code>heroi->usosPocao</code> atingiu o <code>LIMITE_USO_PORCAO</code> (2). Se sim, a l√≥gica exibe um erro e retorna, preservando o turno.</p>
                    </li>
                    <li>
                        <p><strong>Aplica√ß√£o Segura (<code>aplicarPorcao()</code>):</strong></p>
                        <ul style="list-style-type: circle;">
                            <li><p><strong>Cura:</strong> A l√≥gica previne *overflow* de vida usando <code>if (heroi->vidaAtual > heroi->vidaMaxima)</code> para truncar o valor.</p></li>
                            <li><p><strong>Buff:</strong> B√¥nus de Ataque/Defesa s√£o somados diretamente, tornando o **buff persistente** por toda a sess√£o.</p></li>
                        </ul>
                    </li>
                    <li>
                        <p><strong>Registro de Po√ß√£o (O Segundo Log):</strong> Ap√≥s o uso, <code>salvarLogPorcao()</code> gera o timestamp exato e registra o item e o uso atual (ex: 1/2) no <code>HistoricoJogadores.txt</code>.</p>
                    </li>
                </ul>

                <h3>4. Finaliza√ß√£o da Batalha e L√≥gica de Encerramento</h3>
                <p>O fim de <code>lutar()</code> √© o momento final de decis√£o l√≥gica e de log de cada rodada:</p>
                <div id="imagem06">
                    <a href="" class="fotogeral"><img src="../midias/logfinal.png" alt="" title="Estrutura if/else if de encerramento de lutar()"></a>
                </div>
                <ul>
                    <li>
                        <p><strong>Condicionais de Resultado:</strong> A l√≥gica usa <code>if / else if</code> para determinar o fim do loop:</p>
                        <ul style="list-style-type: circle;">
                            <li><p><strong>Vit√≥ria:</strong> <code>if (vidaMonstroAtual <= 0)</code> ‚Äî Exibe <code>venceu()</code> e registra log de **DERROTOU**.</p></li>
                            <li><p><strong>Derrota:</strong> <code>else if (heroi->vidaAtual <= 0)</code> ‚Äî Exibe <code>gameOver()</code> e registra log de **MORREU**.</p></li>
                        </ul>
                    </li>
                    <li>
                        <p><strong>Registro Final de Combate:</strong> A fun√ß√£o <code>salvarLogBatalha()</code> gera o timestamp final da luta e registra o resultado, capturando a vida restante do her√≥i em caso de vit√≥ria ou o inimigo fatal em caso de derrota.</p>
                    </li>
                </ul>
            </section>
        </div>
            <div id="navegacao-doc">
            <a href="parte006.html" class="nav-link voltar">
                <span class="icone-seta">‚¨ÖÔ∏è</span> 
                <span class="texto-nav">Anterior: [T√≥pico Anterior]</span>
            </a>

            <a href="parte007.html" class="nav-link proximo">
                <span class="texto-nav">Pr√≥ximo: [Pr√≥ximo T√≥pico]</span>
                <span class="icone-seta">‚û°Ô∏è</span>
            </a>
    </div>
    </main>

    <footer>
        <a href="https://github.com/NielS2Dev" target="_blank">
            <p>Site Desenvolvido por Antoniel da Silva e Pedro Dias</p>
        </a>
    </footer>

    <script type="module" src="script_001.js"></script>
</body>
</html>